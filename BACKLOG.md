# プロダクトバックログ

## エピック1：営業品質の向上と効率化
営業部門として、営業トークの品質を向上させ、効率的な営業活動を実現したい。

### フィーチャー1.1：音声データ管理基盤
- **ユーザーストーリー1.1.1**：営業担当として、営業音声を簡単にアップロードしたい
  - タスク: 音声ファイルのアップロードUI実装
  - タスク: Azure Blob Storageとの連携実装
  - タスク: メタデータ入力フォーム作成

- **ユーザーストーリー1.1.2**：営業担当として、音声を自動で文字起こしして内容を確認したい
  - タスク: Azure Speech Servicesとの連携
  - タスク: 文字起こし結果の表示UI実装
  - タスク: 話者の区別機能実装

### フィーチャー1.2：検索システム
- **ユーザーストーリー1.2.1**：営業担当として、過去の営業トークを簡単に検索したい
  - タスク: Azure Cognitive Search設定
  - タスク: 検索UI実装
  - タスク: 検索結果表示画面作成

- **ユーザーストーリー1.2.2**：営業担当として、類似した営業トークを見つけたい
  - タスク: ベクトル検索の実装
  - タスク: 類似度スコアの表示
  - タスク: フィルタリング機能の実装

## エピック2：ナレッジマネジメントの確立
マネージャーとして、優良な営業トークをナレッジ化し、組織全体で共有・活用したい。

### フィーチャー2.1：評価システム
- **ユーザーストーリー2.1.1**：マネージャーとして、音声データに評価とコメントを付けたい
  - タスク: 評価入力フォーム作成
  - タスク: コメント機能実装
  - タスク: 評価履歴の表示機能実装

- **ユーザーストーリー2.1.2**：マネージャーとして、タグごとに評価を付けたい
  - タスク: タグ評価機能の実装
  - タスク: タグ評価の集計機能実装
  - タスク: タグ評価の表示UI作成

### フィーチャー2.2：分析・レポート
- **ユーザーストーリー2.2.1**：マネージャーとして、評価の統計情報を確認したい
  - タスク: 評価集計機能の実装
  - タスク: グラフ表示機能の実装
  - タスク: レポート出力機能の実装

## エピック3：セキュリティとコンプライアンス
情報セキュリティ部門として、音声データを安全に管理し、コンプライアンスを確保したい。

### フィーチャー3.1：認証・認可
- **ユーザーストーリー3.1.1**：管理者として、ユーザーの権限を適切に管理したい
  - タスク: ユーザー認証の実装
  - タスク: 権限管理機能の実装
  - タスク: アクセス制御の実装

### フィーチャー3.2：監査
- **ユーザーストーリー3.2.1**：管理者として、システムの利用状況を監査したい
  - タスク: 監査ログの実装
  - タスク: ログ分析機能の実装
  - タスク: アラート機能の実装

## Doneの定義
- コードレビュー完了
- 単体テスト実施
- 結合テスト実施
- セキュリティチェック完了
- パフォーマンステスト完了
- ドキュメント作成完了

## 技術方針（更新）
- Azure Functions での SQL 接続においては、**SQLバインディングは使用せず、`pyodbc` も使わない方針**。
- 接続方式は `Microsoft.Data.SqlClient` または Entra ID の `Active Directory Default` 認証を前提とし、ローカル環境では `local.settings.json` を通じた環境変数ベースで接続。
- テーブル設計も極力増やさず、既存構成を尊重して拡張する。

※その他のテスト項目・実装ステップ・環境構成は現状維持。

（以降は元の開発バックログおよびテスト計画をそのまま利用）

## 本番環境公開後にやること

### Azure Functions の認証設定
- [ ] Function App の Managed Identity を有効化
  - Azure Portal で Function App の「設定」→「ID」から有効化
  - システム割り当てマネージド ID を選択

- [ ] Object ID の取得
  - 有効化後、Object ID をコピー
  - この ID を SQL のユーザー作成時に使用

### Azure SQL の設定
- [ ] 外部プロバイダーユーザーの作成
  ```sql
  CREATE USER [<function-app-name>] FROM EXTERNAL PROVIDER;
  ```

- [ ] 権限の割り当て
  ```sql
  -- 読み取り権限
  ALTER ROLE db_datareader ADD MEMBER [<function-app-name>];
  
  -- 書き込み権限
  ALTER ROLE db_datawriter ADD MEMBER [<function-app-name>];
  ```

### 動作確認
- [ ] データベース接続テスト
  - `/api/test/db-connection` エンドポイントで確認
  - ログで認証方法とトークンの有効期限を確認

- [ ] 各機能の動作確認
  - 会議一覧の取得
  - コメントの追加・取得
  - フィードバックの追加・取得

### セキュリティ確認
- [ ] アクセストークンの有効期限確認
- [ ] エラーログの確認
- [ ] 不要な認証情報の削除
  - `local.settings.json` から認証情報を削除
  - 環境変数から認証情報を削除

## 🗂 プロダクトバックログ

### フィーチャー4.1：会話分析の高度化 [未対応]
- **ユーザーストーリー4.1.1**：営業担当として、会話の品質を向上させたい [未対応]
  - タスク: ChatGPTを活用した会話文章の修正機能実装 [未対応]
    - 間投詞・フィラーの自動削除 [未対応]
      - 詳細: 「えっと」等の間投詞、フィラーを自動的に削除
      - 技術要件: ChatGPT APIを使用した文章の前処理
      - 期待効果: より読みやすい会話テキストの生成
    - 相槌の会話の適切な処理 [未対応]
      - 詳細: 1秒以内の相槌会話（例：「です。それで」→「です。」「それで」）を括弧で囲み、話者の会話に統合
      - 技術要件: 音声タイムスタンプの分析と会話の再構築
      - 期待効果: より自然な会話フローの表現
  - タスク: 会話テーマの自動要約機能実装 [未対応]
    - 15-30分ブロックでの会話分割 [未対応]
      - 詳細: 会話を15-30分単位でブロック分割
      - 技術要件: 時間ベースのセグメンテーション
      - 期待効果: 効率的な会話の管理と分析
    - テーマタイトルの自動設定 [未対応]
      - 詳細: 各ブロックに「アイスブレイク」「アポ取り」などの適切なタイトルを自動設定
      - 技術要件: ChatGPT APIを使用したテーマ分析
      - 期待効果: 会話の目的と流れの明確化
    - シークバーでの表示実装 [未対応]
      - 詳細: YouTubeライクなシークバーでのテーマ表示
      - 技術要件: カスタムシークバーコンポーネントの実装
      - 期待効果: 直感的な会話ナビゲーション

### フィーチャー4.2：フィードバック画面の改善 [未対応]
- **ユーザーストーリー4.2.1**：営業担当として、より効率的にフィードバックを確認したい [未対応]
  - タスク: フィードバック画面のUI改善 [未対応]
    - 文字サイズの最適化 [未対応]
      - 詳細: 文字サイズを小さくし、表示領域を最大化
      - 技術要件: レスポンシブなフォントサイズ設定
      - 期待効果: より多くの会話テキストの表示
    - ヘッダーの最小化 [未対応]
      - 詳細: ヘッダー部分を最小限の表示に
      - 技術要件: コラプシブルヘッダーの実装
      - 期待効果: コンテンツ表示領域の拡大
    - 再生コントロールの整理 [未対応]
      - 詳細: 再生ボタンなどのUI要素を削除または最小化
      - 技術要件: カスタムコントロールの実装
      - 期待効果: シンプルで使いやすいUI
    - 折りたたみ表示の実装 [未対応]
      - 詳細: 初期状態で最初10文字と最後10文字のみを表示
      - 技術要件: アコーディオンUIの実装
      - 期待効果: 効率的な会話の概要把握
    - 話者表示の最適化 [未対応]
      - 詳細: Speaker1/Speaker2の表示と時間表示の削除
      - 技術要件: 表示ロジックの最適化
      - 期待効果: より多くの会話テキストの表示
  - タスク: 音声再生機能の強化 [未対応]
    - 連続再生機能の実装 [未対応]
      - 詳細: 音声再生ボタン押下後、操作がない場合は継続再生
      - 技術要件: 自動再生制御の実装
      - 期待効果: スムーズな会話の聴取
    - 再生位置の視覚的表示 [未対応]
      - 詳細: 再生中の部分を視覚的に強調（チャット文字の変更など）
      - 技術要件: リアルタイムハイライト機能
      - 期待効果: 現在の再生位置の明確な把握
    - 部分再生機能の実装 [未対応]
      - 詳細: 会話チャットクリックで該当部分を再生
      - 技術要件: セグメントベースの再生制御
      - 期待効果: 効率的な会話の確認
    - シークバーの追加 [未対応]
      - 詳細: 下部に音声再生ボタンと全体シークバーを配置
      - 技術要件: カスタムシークバーコンポーネント
      - 期待効果: 直感的な音声制御
  - タスク: コメント機能の改善 [未対応]
    - コメント位置へのジャンプ機能 [未対応]
      - 詳細: コメントが挿入されている部分への即時ジャンプ
      - 技術要件: アンカー機能の実装
      - 期待効果: 効率的なコメント確認
    - スマートフォン対応のUI改善 [未対応]
      - 詳細: コメント送信ボタンの表示崩れ修正
      - 技術要件: レスポンシブデザインの最適化
      - 期待効果: モバイルでの快適な操作

### 既知のバグ
1. フィードバック画面でのコメント挿入時のタイムアウトエラー [未対応]
   - 状況: コメント挿入時に一時的にタイムアウトが発生
   - 影響: 一時的な機能停止
   - 対応: 再試行で成功する場合あり
   - 技術的な詳細: 
     - 原因: サーバーサイドの処理時間超過
     - 影響範囲: コメント挿入機能
     - 再現条件: 特定の条件下でのコメント挿入時

2. フィードバック画面のスマートフォン表示の問題 [未対応]
   - 状況: コメント送信ボタンが正しく表示されない
   - 影響: モバイルユーザーの操作性低下
   - 対応: レスポンシブデザインの見直しが必要
   - 技術的な詳細:
     - 原因: ビューポートサイズに応じたレイアウトの不適切な調整
     - 影響範囲: モバイル表示時のコメント機能
     - 再現条件: 特定の画面サイズでの表示時

### 技術的な検討事項
1. 会話セグメントのデータ構造 [未対応]
   - 現状: `ConversationSegments`テーブルの構造
   - 課題: 部分再生機能の実装に伴う構造の見直し
   - 検討: 新規テーブルの追加または既存構造の拡張
   - 技術的な詳細:
     - 現行構造の制約: 部分再生に必要な情報の不足
     - 検討中の解決策: 
       - 新規テーブル追加による拡張
       - 既存テーブルの構造変更
     - 影響範囲: 音声再生機能全体

2. コメントジャンプ機能の実装方法 [未対応]
   - 要件: コメント位置への効率的なナビゲーション
   - 検討: 実装方法の詳細設計が必要
   - 技術的な詳細:
     - 実装候補:
       - アンカーリンク方式
       - スクロール位置制御
       - カスタムナビゲーション
     - 考慮事項:
       - パフォーマンス
       - ユーザー体験
       - 実装の複雑さ
