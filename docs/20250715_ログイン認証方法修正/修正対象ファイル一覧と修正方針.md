ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã¨ä¿®æ­£æ–¹é‡
â‘  å¿…é ˆã®ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ—¢å­˜ï¼‰
ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹	ç›®çš„	ä¿®æ­£å†…å®¹
src/hooks/useAuth.tsx	èªè¨¼çŠ¶æ…‹ãƒ»ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†	âœ… Cookieã®è¨­å®šã‚’å‰Šé™¤ã€‚API Routeã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤‰æ›´
src/components/auth/ProtectedRoute.tsx	ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¬ãƒ¼ãƒ‰	âœ… SSRã«ä»»ã›ã‚‹å‰æãªã‚‰å»ƒæ­¢ã¾ãŸã¯ç°¡ç´ åŒ–
middleware.ts	SSRã§ã®ãƒ­ã‚°ã‚¤ãƒ³åˆ¤å®š	âœ… authToken ã®JWTæ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ï¼ˆç¾åœ¨ã¯ç°¡æ˜“ãƒã‚§ãƒƒã‚¯ï¼‰
src/app/layout.tsx	ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ	ğŸ” ç‰¹ã«ä¿®æ­£ä¸è¦ï¼ˆClientProvidersãŒæ­£ã—ãã‚ã‚Œã°ï¼‰
src/components/ClientProviders.tsx	èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼	ğŸ” useAuthã«ä¾å­˜ã—ã¦ã„ã‚Œã°ã€ä¾å­˜é–¢ä¿‚ã‚’æ•´ç†ãƒ»ç°¡ç´ åŒ–æ¤œè¨

â‘¡ æ–°è¦ä½œæˆãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«
ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹	ç›®çš„	å®Ÿè£…å†…å®¹
src/app/api/auth/login/route.ts	èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡ŒAPI	âœ… Azure Function /users/login ã‚’å‘¼ã³å‡ºã—ã€JWTã‚’HttpOnly Cookieã«ä¿å­˜
src/app/api/auth/logout/route.ts	ãƒ­ã‚°ã‚¢ã‚¦ãƒˆAPI	âœ… Cookieã‚’å‰Šé™¤ã™ã‚‹ã ã‘ã®å‡¦ç†ã‚’å®Ÿè£…ï¼ˆSet-Cookieãƒ˜ãƒƒãƒ€ãƒ¼ã§ç„¡åŠ¹åŒ–ï¼‰

â‘¢ ä»Šå¾Œã®APIå‘¼ã³å‡ºã—å¤‰æ›´ï¼ˆuseAuth.tsxå†…ï¼‰
ç¾åœ¨ï¼š

ts
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
await fetch(`${process.env.NEXT_PUBLIC_API_BASE_URL}/users/login`, {...})
Cookies.set('authToken', ...)
ä»Šå¾Œï¼š

ts
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
await fetch('/api/auth/login', {
  method: 'POST',
  body: JSON.stringify({ email, password }),
})
â†’ ã“ã® /api/auth/login ãŒå†…éƒ¨ã§ Azure Function ã‚’å©ã„ã¦ token ã‚’ Cookie ã«ä¿å­˜

â‘£ middleware.ts ã®ä¿®æ­£æ–¹é‡
ç¾åœ¨ï¼š

ts
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
const token = request.cookies.get('authToken')?.value
const isAuthenticated = !!token
ä¿®æ­£å¾Œï¼š

ts
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
import jwt from 'jsonwebtoken'

try {
  const decoded = jwt.verify(token, process.env.JWT_SECRET)
  return NextResponse.next()
} catch {
  return NextResponse.redirect(new URL('/', request.url))
}
matcher ã¯ç¾åœ¨ã®ã¾ã¾ã§å…¨ãƒšãƒ¼ã‚¸å¯¾è±¡ã«ãªã£ã¦ã„ã‚‹ãŸã‚ è¿½åŠ è¨­å®šä¸è¦

âœ… çµè«–
ã“ã®æ§‹æˆãªã‚‰ï¼š

å…¨ãƒšãƒ¼ã‚¸ SSRã§èªè¨¼å¯

ãƒ•ãƒ­ãƒ³ãƒˆã¯çŠ¶æ…‹ç®¡ç†ã«å°‚å¿µã§ãã€XSSã«ã‚‚å¼·ã„

Azure Functions ã®æ—¢å­˜æ§‹æˆã¯ã»ã¼ãã®ã¾ã¾æ´»ã‹ã›ã‚‹